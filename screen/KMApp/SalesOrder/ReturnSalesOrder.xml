<screen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.0.xsd" default-menu-include="false">

    <parameter name="orderId" required="true"/>
    <parameter name="returnId"/>

    <transition name="returnOrder">
        <service-call name="OrderServices.return#OrderItems" in-map="context" out-map="context"/>
        <default-response url="//km/Return/ReturnDetail">
            <parameter name="returnId"/>
        </default-response>
    </transition>

    <actions>
        <service-call name="mantle.order.OrderServices.get#OrderDisplayInfo" in-map="[orderId:orderId]" out-map="context"/>
        <set field="orderPartInfo" from="orderPartInfoList[0]"/>

        <entity-find entity-name="mantle.order.OrderItemDetail" list="orderItem">
            <search-form-inputs default-order-by="-orderItemSeqId"/>
            <econdition field-name="orderId"/>
            <order-by field-name="orderItemSeqId"/>
        </entity-find>
    </actions>

    <widgets>
        <label text="订单 #${orderId}" type="h2"/>
        <container>
            <label text="日期: " type="strong"/>
            <label text="${ec.l10n.format(orderHeader.placedDate ?: orderHeader.entryDate, 'yyyy年M月d日 HH:mm')}"/>
        </container><container>
            <label text="客户: " type="strong"/>
            <label text="${orderPartInfo.customerDetail.organizationName?:''}${orderPartInfo.customerDetail.firstName?:''} ${orderPartInfo.customerDetail.lastName?:''} [${orderPartInfo.customerDetail.pseudoId}]"/>
        </container>
        <form-list name="OrderHistoryList" list="orderItem" multi="true" transition="returnOrder" paginate="false">

            <field name="orderId"><default-field><hidden/></default-field></field>
            <field name="orderPartSeqId"><default-field><hidden/></default-field></field>
            <field name="_useRowSubmit"><default-field><hidden default-value="true"/></default-field></field>
            <field name="_rowSubmit"><default-field title=" "><check no-current-selected-key="false"><option key="true" text=" "/></check></default-field></field>

            <field name="orderItemSeqId">
                <default-field ><display/></default-field>
            </field>
            <field name="productId">
                <default-field title="Product">
                    <display-entity entity-name="mantle.product.Product" text="ProductNameTemplate"/>
                </default-field>
            </field>

            <field name="unitAmount">
                <default-field title="单价"><text-line size="8" format="#0.00"/></default-field>
            </field>

            <field name="quantity">
                <default-field title="数量"><text-line size="5"/></default-field>
            </field>

            <field name="submitButton">
                <default-field title="退货"><submit confirmation="Are you sure?"/></default-field>
            </field>
        </form-list>

    </widgets>
</screen>
